<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Œæ•´ç³»ç»Ÿæµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-4xl font-bold text-center mb-8">ğŸ¯ å¹¸è¿æŠ½å¥–ç³»ç»Ÿå®Œæ•´æµ‹è¯•</h1>
        
        <!-- ç³»ç»ŸçŠ¶æ€æ€»è§ˆ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4 text-blue-600">ğŸ”— è¿æ¥çŠ¶æ€</h3>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span>ç½‘ç»œ:</span>
                        <span id="network-status" class="font-semibold">æ£€æŸ¥ä¸­...</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Supabase:</span>
                        <span id="supabase-status" class="font-semibold">æ£€æŸ¥ä¸­...</span>
                    </div>
                    <div class="flex justify-between">
                        <span>æ•°æ®åŒæ­¥:</span>
                        <span id="sync-status" class="font-semibold">æ£€æŸ¥ä¸­...</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4 text-green-600">ğŸ“Š æ•°æ®ç»Ÿè®¡</h3>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span>æ³¨å†Œç”¨æˆ·:</span>
                        <span id="user-count" class="font-semibold">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span>æŠ½å¥–è®°å½•:</span>
                        <span id="draw-count" class="font-semibold">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span>å¾…åŒæ­¥:</span>
                        <span id="pending-sync" class="font-semibold">0</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4 text-purple-600">âš¡ å¿«é€Ÿæ“ä½œ</h3>
                <div class="space-y-2">
                    <button id="refresh-data" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">
                        åˆ·æ–°æ•°æ®
                    </button>
                    <button id="force-sync" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600">
                        å¼ºåˆ¶åŒæ­¥
                    </button>
                    <button id="clear-all" class="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600">
                        æ¸…ç©ºæµ‹è¯•æ•°æ®
                    </button>
                </div>
            </div>
        </div>
        
        <!-- æµ‹è¯•æ“ä½œåŒºåŸŸ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- ç”¨æˆ·æ³¨å†Œæµ‹è¯• -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-semibold mb-6 text-blue-600">ğŸ‘¤ ç”¨æˆ·æ³¨å†Œæµ‹è¯•</h2>
                
                <form id="test-registration-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">å§“å</label>
                        <input type="text" id="test-name" class="w-full border rounded-lg px-3 py-2" 
                               placeholder="è¾“å…¥æµ‹è¯•ç”¨æˆ·å§“å" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">æ‰‹æœºå·</label>
                        <input type="tel" id="test-phone" class="w-full border rounded-lg px-3 py-2" 
                               placeholder="è¾“å…¥æ‰‹æœºå·" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">é‚®ç®±</label>
                        <input type="email" id="test-email" class="w-full border rounded-lg px-3 py-2" 
                               placeholder="è¾“å…¥é‚®ç®±åœ°å€" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">åœ°å€</label>
                        <input type="text" id="test-address" class="w-full border rounded-lg px-3 py-2" 
                               placeholder="è¾“å…¥åœ°å€" required>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button type="submit" class="flex-1 bg-blue-500 text-white py-2 rounded hover:bg-blue-600">
                            æ³¨å†Œç”¨æˆ·
                        </button>
                        <button type="button" id="generate-random-user" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                            éšæœºç”Ÿæˆ
                        </button>
                    </div>
                </form>
                
                <div id="registration-result" class="mt-4 p-3 rounded hidden"></div>
            </div>
            
            <!-- æŠ½å¥–æµ‹è¯• -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-semibold mb-6 text-green-600">ğŸ² æŠ½å¥–åŠŸèƒ½æµ‹è¯•</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">é€‰æ‹©ç”¨æˆ·</label>
                        <select id="user-select" class="w-full border rounded-lg px-3 py-2" aria-label="é€‰æ‹©ç”¨æˆ·" title="é€‰æ‹©ç”¨æˆ·"></select>
                            <option value="">è¯·å…ˆæ³¨å†Œç”¨æˆ·</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">å¥–å“è®¾ç½®</label>
                        <select id="prize-select" class="w-full border rounded-lg px-3 py-2" aria-label="é€‰æ‹©å¥–å“" title="é€‰æ‹©å¥–å“"></select>
                            <option value="ä¸€ç­‰å¥– - iPhone 15">ä¸€ç­‰å¥– - iPhone 15</option>
                            <option value="äºŒç­‰å¥– - iPad">äºŒç­‰å¥– - iPad</option>
                            <option value="ä¸‰ç­‰å¥– - AirPods">ä¸‰ç­‰å¥– - AirPods</option>
                            <option value="å‚ä¸å¥– - ä¼˜æƒ åˆ¸">å‚ä¸å¥– - ä¼˜æƒ åˆ¸</option>
                            <option value="è°¢è°¢å‚ä¸">è°¢è°¢å‚ä¸</option>
                        </select>
                    </div>
                    
                    <button id="simulate-draw" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600">
                        æ¨¡æ‹ŸæŠ½å¥–
                    </button>
                    
                    <div class="bg-gray-50 p-3 rounded">
                        <h4 class="font-semibold mb-2">å½“å‰ç”¨æˆ·ä¿¡æ¯:</h4>
                        <div id="current-user-info" class="text-sm text-gray-600">
                            è¯·é€‰æ‹©ç”¨æˆ·
                        </div>
                    </div>
                </div>
                
                <div id="draw-result" class="mt-4 p-3 rounded hidden"></div>
            </div>
        </div>
        
        <!-- æ•°æ®å±•ç¤ºåŒºåŸŸ -->
        <div class="mt-8 bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-semibold mb-6 text-purple-600">ğŸ“‹ æ•°æ®å±•ç¤º</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- ç”¨æˆ·åˆ—è¡¨ -->
                <div>
                    <h3 class="text-lg font-semibold mb-4">æ³¨å†Œç”¨æˆ·åˆ—è¡¨</h3>
                    <div id="users-list" class="space-y-2 max-h-64 overflow-y-auto">
                        <div class="text-gray-500 text-center py-4">æš‚æ— ç”¨æˆ·æ•°æ®</div>
                    </div>
                </div>
                
                <!-- æŠ½å¥–è®°å½• -->
                <div>
                    <h3 class="text-lg font-semibold mb-4">æŠ½å¥–è®°å½•</h3>
                    <div id="draws-list" class="space-y-2 max-h-64 overflow-y-auto">
                        <div class="text-gray-500 text-center py-4">æš‚æ— æŠ½å¥–è®°å½•</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ“ä½œæ—¥å¿— -->
        <div class="mt-8 bg-white rounded-lg shadow-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-semibold text-gray-600">ğŸ“ æ“ä½œæ—¥å¿—</h2>
                <button id="clear-log" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                    æ¸…ç©ºæ—¥å¿—
                </button>
            </div>
            <div id="log-output" class="bg-gray-50 p-4 rounded h-48 overflow-y-auto font-mono text-sm">
                <div class="text-gray-500">ç³»ç»Ÿåˆå§‹åŒ–ä¸­...</div>
            </div>
        </div>
    </div>
    
    <!-- å¼•å…¥å¿…è¦çš„è„šæœ¬ -->
    <script src="config.js"></script>
    <script src="supabase-config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-connection.js"></script>
    <script src="data-sync-manager.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let users = [];
        let drawRecords = [];
        let currentSelectedUser = null;
        
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logOutput = document.getElementById('log-output');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-blue-600',
                success: 'text-green-600',
                warning: 'text-yellow-600',
                error: 'text-red-600'
            };
            
            const logEntry = document.createElement('div');
            logEntry.className = colors[type] || 'text-gray-600';
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            
            logOutput.appendChild(logEntry);
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus() {
            // ç½‘ç»œçŠ¶æ€
            document.getElementById('network-status').textContent = navigator.onLine ? 'å·²è¿æ¥' : 'ç¦»çº¿';
            document.getElementById('network-status').className = navigator.onLine ? 'font-semibold text-green-600' : 'font-semibold text-red-600';
            
            // SupabaseçŠ¶æ€
            const supabaseStatus = window.supabase ? 'å·²è¿æ¥' : 'æœªè¿æ¥';
            document.getElementById('supabase-status').textContent = supabaseStatus;
            document.getElementById('supabase-status').className = window.supabase ? 'font-semibold text-green-600' : 'font-semibold text-red-600';
            
            // æ•°æ®åŒæ­¥çŠ¶æ€
            if (window.dataSyncManager) {
                const syncStatus = window.dataSyncManager.getSyncStatus();
                document.getElementById('sync-status').textContent = syncStatus.isOnline ? 'æ­£å¸¸' : 'ç¦»çº¿';
                document.getElementById('sync-status').className = syncStatus.isOnline ? 'font-semibold text-green-600' : 'font-semibold text-yellow-600';
                document.getElementById('pending-sync').textContent = syncStatus.pendingItems;
            }
            
            // æ•°æ®ç»Ÿè®¡
            document.getElementById('user-count').textContent = users.length;
            document.getElementById('draw-count').textContent = drawRecords.length;
        }
        
        // ç”Ÿæˆéšæœºç”¨æˆ·æ•°æ®
        function generateRandomUser() {
            const names = ['å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'é’±ä¸ƒ', 'å­™å…«', 'å‘¨ä¹', 'å´å'];
            const domains = ['gmail.com', 'qq.com', '163.com', 'hotmail.com'];
            const cities = ['åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·', 'æ·±åœ³', 'æ­å·', 'å—äº¬', 'æˆéƒ½', 'æ­¦æ±‰'];
            
            const randomName = names[Math.floor(Math.random() * names.length)];
            const randomPhone = '1' + Math.floor(Math.random() * 10000000000).toString().padStart(10, '0');
            const randomEmail = `user${Date.now()}@${domains[Math.floor(Math.random() * domains.length)]}`;
            const randomAddress = cities[Math.floor(Math.random() * cities.length)] + 'å¸‚æµ‹è¯•åœ°å€' + Math.floor(Math.random() * 999);
            
            document.getElementById('test-name').value = randomName;
            document.getElementById('test-phone').value = randomPhone;
            document.getElementById('test-email').value = randomEmail;
            document.getElementById('test-address').value = randomAddress;
        }
        
        // å¤„ç†ç”¨æˆ·æ³¨å†Œ
        async function handleTestRegistration(event) {
            event.preventDefault();
            
            const userData = {
                name: document.getElementById('test-name').value,
                phone: document.getElementById('test-phone').value,
                email: document.getElementById('test-email').value,
                address: document.getElementById('test-address').value,
                drawchances: 3,
                joindate: new Date().toISOString(),
                prizeswon: []
            };
            
            log(`ğŸ”„ å¼€å§‹æ³¨å†Œç”¨æˆ·: ${userData.name}`, 'info');
            
            try {
                const result = await window.dataSyncManager.syncUserData(userData);
                
                if (result.success) {
                    users.push(userData);
                    updateUserSelect();
                    updateUsersDisplay();
                    
                    const resultDiv = document.getElementById('registration-result');
                    resultDiv.className = 'mt-4 p-3 rounded bg-green-100 text-green-800';
                    resultDiv.textContent = `âœ… ç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼${result.offline ? ' (ç¦»çº¿æ¨¡å¼)' : ''}`;
                    resultDiv.classList.remove('hidden');
                    
                    log(`âœ… ç”¨æˆ·æ³¨å†ŒæˆåŠŸ: ${userData.name} ${result.offline ? '(ç¦»çº¿æ¨¡å¼)' : '(åœ¨çº¿æ¨¡å¼)'}`, 'success');
                    
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('test-registration-form').reset();
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                const resultDiv = document.getElementById('registration-result');
                resultDiv.className = 'mt-4 p-3 rounded bg-red-100 text-red-800';
                resultDiv.textContent = `âŒ æ³¨å†Œå¤±è´¥: ${error.message}`;
                resultDiv.classList.remove('hidden');
                
                log(`âŒ ç”¨æˆ·æ³¨å†Œå¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStatus();
        }
        
        // æ›´æ–°ç”¨æˆ·é€‰æ‹©ä¸‹æ‹‰æ¡†
        function updateUserSelect() {
            const select = document.getElementById('user-select');
            select.innerHTML = '<option value="">é€‰æ‹©ç”¨æˆ·è¿›è¡ŒæŠ½å¥–</option>';
            
            users.forEach((user, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${user.name} (${user.phone}) - å‰©ä½™${user.drawchances}æ¬¡`;
                select.appendChild(option);
            });
        }
        
        // å¤„ç†ç”¨æˆ·é€‰æ‹©
        function handleUserSelect() {
            const select = document.getElementById('user-select');
            const selectedIndex = select.value;
            
            if (selectedIndex !== '') {
                currentSelectedUser = users[selectedIndex];
                updateCurrentUserInfo();
            } else {
                currentSelectedUser = null;
                document.getElementById('current-user-info').textContent = 'è¯·é€‰æ‹©ç”¨æˆ·';
            }
        }
        
        // æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
        function updateCurrentUserInfo() {
            if (!currentSelectedUser) return;
            
            const info = `
                å§“å: ${currentSelectedUser.name}<br>
                æ‰‹æœº: ${currentSelectedUser.phone}<br>
                é‚®ç®±: ${currentSelectedUser.email}<br>
                å‰©ä½™æŠ½å¥–æ¬¡æ•°: ${currentSelectedUser.drawchances}<br>
                å·²è·å¥–å“: ${currentSelectedUser.prizeswon.length > 0 ? currentSelectedUser.prizeswon.map(p => p.prize).join(', ') : 'æ— '}
            `;
            
            document.getElementById('current-user-info').innerHTML = info;
        }
        
        // æ¨¡æ‹ŸæŠ½å¥–
        async function simulateDraw() {
            if (!currentSelectedUser) {
                alert('è¯·å…ˆé€‰æ‹©ç”¨æˆ·');
                return;
            }
            
            if (currentSelectedUser.drawchances <= 0) {
                alert('è¯¥ç”¨æˆ·å·²æ— å‰©ä½™æŠ½å¥–æ¬¡æ•°');
                return;
            }
            
            const selectedPrize = document.getElementById('prize-select').value;
            
            const drawData = {
                userPhone: currentSelectedUser.phone,
                prize: selectedPrize,
                timestamp: new Date().toISOString()
            };
            
            log(`ğŸ² å¼€å§‹æ¨¡æ‹ŸæŠ½å¥–: ${currentSelectedUser.name} -> ${selectedPrize}`, 'info');
            
            try {
                const result = await window.dataSyncManager.syncDrawRecord(drawData);
                
                if (result.success) {
                    // æ›´æ–°æœ¬åœ°ç”¨æˆ·æ•°æ®
                    currentSelectedUser.drawchances -= 1;
                    if (selectedPrize !== 'è°¢è°¢å‚ä¸') {
                        currentSelectedUser.prizeswon.push({
                            prize: selectedPrize,
                            timestamp: drawData.timestamp
                        });
                    }
                    
                    // æ›´æ–°è®°å½•
                    drawRecords.push(drawData);
                    
                    // æ›´æ–°æ˜¾ç¤º
                    updateUserSelect();
                    updateCurrentUserInfo();
                    updateUsersDisplay();
                    updateDrawsDisplay();
                    
                    const resultDiv = document.getElementById('draw-result');
                    resultDiv.className = 'mt-4 p-3 rounded bg-green-100 text-green-800';
                    resultDiv.textContent = `ğŸ‰ æŠ½å¥–æˆåŠŸï¼è·å¾—: ${selectedPrize} ${result.offline ? '(ç¦»çº¿æ¨¡å¼)' : ''}`;
                    resultDiv.classList.remove('hidden');
                    
                    log(`ğŸ‰ æŠ½å¥–æˆåŠŸ: ${currentSelectedUser.name} è·å¾— ${selectedPrize} ${result.offline ? '(ç¦»çº¿æ¨¡å¼)' : '(åœ¨çº¿æ¨¡å¼)'}`, 'success');
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                const resultDiv = document.getElementById('draw-result');
                resultDiv.className = 'mt-4 p-3 rounded bg-red-100 text-red-800';
                resultDiv.textContent = `âŒ æŠ½å¥–å¤±è´¥: ${error.message}`;
                resultDiv.classList.remove('hidden');
                
                log(`âŒ æŠ½å¥–å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStatus();
        }
        
        // æ›´æ–°ç”¨æˆ·åˆ—è¡¨æ˜¾ç¤º
        function updateUsersDisplay() {
            const container = document.getElementById('users-list');
            
            if (users.length === 0) {
                container.innerHTML = '<div class="text-gray-500 text-center py-4">æš‚æ— ç”¨æˆ·æ•°æ®</div>';
                return;
            }
            
            container.innerHTML = users.map(user => `
                <div class="border rounded p-3 bg-gray-50">
                    <div class="font-semibold">${user.name}</div>
                    <div class="text-sm text-gray-600">
                        ğŸ“± ${user.phone} | âœ‰ï¸ ${user.email}<br>
                        ğŸ¯ å‰©ä½™${user.drawchances}æ¬¡ | ğŸ† ${user.prizeswon.length}ä¸ªå¥–å“
                    </div>
                </div>
            `).join('');
        }
        
        // æ›´æ–°æŠ½å¥–è®°å½•æ˜¾ç¤º
        function updateDrawsDisplay() {
            const container = document.getElementById('draws-list');
            
            if (drawRecords.length === 0) {
                container.innerHTML = '<div class="text-gray-500 text-center py-4">æš‚æ— æŠ½å¥–è®°å½•</div>';
                return;
            }
            
            container.innerHTML = drawRecords.slice(-10).reverse().map(record => {
                const user = users.find(u => u.phone === record.userPhone);
                return `
                    <div class="border rounded p-3 bg-gray-50">
                        <div class="font-semibold">${user ? user.name : record.userPhone}</div>
                        <div class="text-sm text-gray-600">
                            ğŸ ${record.prize}<br>
                            â° ${new Date(record.timestamp).toLocaleString()}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // åˆ·æ–°æ•°æ®
        async function refreshData() {
            log('ğŸ”„ åˆ·æ–°æ•°æ®...', 'info');
            updateStatus();
            log('âœ… æ•°æ®å·²åˆ·æ–°', 'success');
        }
        
        // å¼ºåˆ¶åŒæ­¥
        async function forceSync() {
            log('ğŸ”„ å¼€å§‹å¼ºåˆ¶åŒæ­¥...', 'info');
            
            try {
                await window.dataSyncManager.forcSync();
                log('âœ… å¼ºåˆ¶åŒæ­¥å®Œæˆ', 'success');
            } catch (error) {
                log(`âŒ å¼ºåˆ¶åŒæ­¥å¤±è´¥: ${error.message}`, 'error');
            }
            
            updateStatus();
        }
        
        // æ¸…ç©ºæµ‹è¯•æ•°æ®
        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æµ‹è¯•æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                users = [];
                drawRecords = [];
                currentSelectedUser = null;
                
                updateUserSelect();
                updateUsersDisplay();
                updateDrawsDisplay();
                updateStatus();
                
                document.getElementById('current-user-info').textContent = 'è¯·é€‰æ‹©ç”¨æˆ·';
                
                // æ¸…ç©ºåŒæ­¥é˜Ÿåˆ—
                if (window.dataSyncManager) {
                    window.dataSyncManager.clearSyncQueue();
                }
                
                log('ğŸ—‘ï¸ æ‰€æœ‰æµ‹è¯•æ•°æ®å·²æ¸…ç©º', 'warning');
            }
        }
        
        // æ¸…ç©ºæ—¥å¿—
        function clearLog() {
            document.getElementById('log-output').innerHTML = '<div class="text-gray-500">æ—¥å¿—å·²æ¸…ç©º...</div>';
        }
        
        // åˆå§‹åŒ–
        async function init() {
            log('ğŸš€ ç³»ç»Ÿåˆå§‹åŒ–å¼€å§‹...', 'info');
            
            // ç­‰å¾…æ•°æ®åŒæ­¥ç®¡ç†å™¨åˆå§‹åŒ–
            if (window.dataSyncManager) {
                try {
                    await window.dataSyncManager.init();
                    log('âœ… æ•°æ®åŒæ­¥ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ', 'success');
                } catch (error) {
                    log(`âŒ æ•°æ®åŒæ­¥ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                log('âŒ æ•°æ®åŒæ­¥ç®¡ç†å™¨æœªåŠ è½½', 'error');
            }
            
            updateStatus();
            
            // è®¾ç½®å®šæ—¶æ›´æ–°
            setInterval(updateStatus, 3000);
            
            log('âœ… ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ', 'success');
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('DOMContentLoaded', () => {
            // è¡¨å•äº‹ä»¶
            document.getElementById('test-registration-form').addEventListener('submit', handleTestRegistration);
            document.getElementById('generate-random-user').addEventListener('click', generateRandomUser);
            document.getElementById('user-select').addEventListener('change', handleUserSelect);
            document.getElementById('simulate-draw').addEventListener('click', simulateDraw);
            
            // æ“ä½œæŒ‰é’®
            document.getElementById('refresh-data').addEventListener('click', refreshData);
            document.getElementById('force-sync').addEventListener('click', forceSync);
            document.getElementById('clear-all').addEventListener('click', clearAllData);
            document.getElementById('clear-log').addEventListener('click', clearLog);
            
            // ç½‘ç»œçŠ¶æ€ç›‘å¬
            window.addEventListener('online', () => {
                log('ğŸŒ ç½‘ç»œè¿æ¥å·²æ¢å¤', 'success');
                updateStatus();
            });
            
            window.addEventListener('offline', () => {
                log('ğŸ“± ç½‘ç»œè¿æ¥å·²æ–­å¼€', 'warning');
                updateStatus();
            });
            
            // åˆå§‹åŒ–
            init();
        });
    </script>
</body>
</html>